<!DOCTYPE html>
<html>
  <head>
    <title>Mapa de Logística - Eemovel</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100vh;
        width: 100%;
      }
      .leaflet-popup-content {
        font-family: Arial, sans-serif;
        line-height: 1.4;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>

      var map = L.map("map").setView([-24.955, -53.455], 13);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "© OpenStreetMap",
      }).addTo(map);

     function getJson(data) {
    console.log("Dados recebidos do GeoServer:", data); // Isso ajuda a ver os nomes das colunas no F12
    
    L.geoJSON(data, {
        pointToLayer: function (feature, latlng) {
            // Se os pontos aparecerem na África (0,0), inverta latlng abaixo
            return L.circleMarker(latlng, {
                radius: 10,
                fillColor: "#ff0000",
                color: "#ffffff",
                weight: 2,
                opacity: 1,
                fillOpacity: 0.9,
            });
        },
        onEachFeature: function (feature, layer) {
            // O GeoServer pode retornar 'nome' ou 'name'
            var props = feature.properties;
            var nome = props.nome || props.name || props.NOME || "Item";
            var desc = props.descricao || props.description || props.DESCRICAO || "";
            
            layer.bindPopup("<strong>" + nome + "</strong><br>" + desc);
        },
    }).addTo(map);
}


      var wfsUrl =
        "http://localhost:8080/geoserver/logistica/ows?" +
        "service=WFS&version=1.0.0&request=GetFeature&" +
        "typeName=logistica:items&outputFormat=text/javascript&" +
        "format_options=callback:getJson";

      var script = document.createElement("script");
      script.src = wfsUrl;
      document.body.appendChild(script);
    </script>
  </body>
</html>
